<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>My Cozy Corner</title>
  <style>
    @import url('https://fonts.googleapis.com/css?family=Inconsolata');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      font-family: 'Inconsolata', monospace;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      
      background: rgb(22, 22, 22);
      color: white;
      transition: background 0.5s ease, color 0.5s ease;
    }

    .light-mode {
      background: white;
      color: black;
    }

    .light-mode a {
      color: black !important;
    }

    .light-mode .blue {
      color: #007acc;
    }

    .light-mode .comment {
      color: #666;
    }

    .light-mode .load {
      color: #e67e22;
    }

    .wrap {
      width: 100%;
      max-width: 400px;
      text-align: left;
      overflow: hidden;
      position: relative;
    }

    pre {
      font-size: min(3.5vw, 12px);
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
      padding: 4px 40px;
    }

    .blue { color: #48beef; }
    .comment { color: #7f8c8d; }
    .load { color: #f39c12; }

    .theme-toggle {
      cursor: pointer;
      background: none;
      border: none;
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
    }

    .theme-toggle svg {
      width: 32px;
      height: 32px;
      transition: transform 0.5s ease;
    }

    .light-mode .theme-toggle svg {
      transform: rotate(180deg);
    }

    .qr-code {
      margin-top: 10px;
      display: flex;
      justify-content: center;
    }

    a { color: white !important; }

    /* --- New Movie Search Styles --- */
    .movie-search-container {
      margin-top: 10px;
      padding: 5px 40px;
      
    }
    .movie-search-title {
      font-size: 10px;
      margin-bottom: 3px;
      color: #48beef;
    }
    .movie-search-wrapper {
      position: relative;
    }
    .movie-search-input {
      width: 100%;
      padding: 4px 6px;
      margin-top: 5px;
      font-size: 10px;
      border: 1px solid #333;
      border-radius: 99px;
      background: transparent;
      color: white;
      font-family: 'Inconsolata', monospace;
    }
    .movie-suggestions {
      position: absolute;
      top: 24px;
      left: 0;
      right: 0;
      background: rgb(22, 22, 22);
      border: 1px solid #333;
      z-index: 100;
      display: none;
      max-height: 150px;
      overflow-y: auto;
    }
    .movie-suggestion-item {
      display: flex;
      align-items: center;
      padding: 3px 4px;
      cursor: pointer;
      border-bottom: 1px solid #333;
    }
    .movie-suggestion-item:last-child {
      border-bottom: none;
    }
    .movie-suggestion-item:hover {
      background: #333;
    }
    .movie-suggestion-item img {
      width: 20px;
      height: auto;
      margin-right: 4px;
    }
    .movie-suggestion-item .movie-title {
      font-size: 10px;
    }
    /* Updated Light Mode Styles */
.light-mode .movie-search-input {
  background: white;
  color: black;
  border: 1px solid #ccc;
}

.light-mode .movie-suggestions {
  background: white;
  border: 1px solid #ccc;
}

.light-mode .movie-suggestion-item {
  border-bottom: 1px solid #ddd;
  color: black;
}

.light-mode .movie-suggestion-item:hover {
  background: #f5f5f5;
}

.light-mode .movie-title {
  color: black;
}

  </style>
</head>
<body>

  <div class="wrap">
    <pre>
(<span class="blue">function</span>( isDev ) {
     <span class="blue">function</span> bootSequence() {
        <span class="blue">if</span>( isDev ) {
            <span class="blue">return</span>;
        }
        
        <span class="comment">"Access my portfolio here >> <a href='#'>....</a>"</span>
        <span class="comment">"Access private <a href='https://cloud.pranavsatav.me/'>Cloud</a>"</span> 
        <span class="comment">"Cloud Status: <span id='cloud-log-status'>Checking...</span>"</span> 
     }

     window.addEventListener( <span class="load">'load'</span>, boot );
}( <span class="blue">false</span> )); 
    </pre>

    <!-- New Movie Search Block -->
    <div class="movie-search-container">
      <div class="movie-search-title">Watch Movies </div>
      <div class="movie-search-wrapper">
        <input type="text" id="movieSearchInput" class="movie-search-input" placeholder="Search movies &amp; TV..." autocomplete="off">
        <div class="movie-suggestions" id="movieSuggestions"></div>
      </div>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="toggleTheme()">
      <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
        <path id="icon-path" d="M12 3V5 M12 19V21 M12 12m-5 0a5 5 0 1 1 10 0a5 5 0 1 1 -10 0" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div class="qr-code">
      <canvas id="qrCanvas"></canvas>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script>
    async function checkServerStatus() {
        try {
            let response = await fetch("https://cloud.pranavsatav.me/status.php", { method: "GET" });
            if (response.ok) {
                document.getElementById("cloud-log-status").innerText = "Online";
            } else {
                throw new Error("Server unreachable");
            }
        } catch (error) {
            document.getElementById("cloud-log-status").innerText = "Offline";
        }
    }

    function bootSequence() {
        checkServerStatus();
        setInterval(checkServerStatus, 5000);
    }

    window.addEventListener('load', bootSequence);

    function toggleTheme() {
  document.body.classList.toggle("light-mode");
  const iconPath = document.getElementById("icon-path");
  const isLightMode = document.body.classList.contains("light-mode");

  if (isLightMode) {
    iconPath.setAttribute("d", "M12 3V5 M12 19V21 M5 12H3 M21 12h-2 M16.5 7.5l1.5-1.5M7.5 16.5L6 18 M18 18l-1.5-1.5 M6 6l1.5 1.5");
    iconPath.setAttribute("stroke", "black");
  } else {
    iconPath.setAttribute("d", "M12 3V5 M12 19V21 M12 12m-5 0a5 5 0 1 1 10 0a5 5 0 1 1 -10 0");
    iconPath.setAttribute("stroke", "white");
  }
}

    new QRCode(document.getElementById("qrCanvas"), {
        text: "https://cloud.pranavsatav.me/",
        width: 100,
        height: 100
    });
  </script>


<script>
  // TMDB read token (for demo purposes)
  const tmdbToken = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI2Y2QyMWU2NDIxNDAwNTdjZDYzNjJiZjI5ZjlhMzNkMiIsIm5iZiI6MTY5MTkzOTQxNi45OTUwMDAxLCJzdWIiOiI2NGQ4ZjI1ODAwMWJiZDAwYzZjN2FmZjYiLCJzY29wZXMiOlsiYXBpX3JlYWQiXSwidmVyc2lvbiI6MX0.1iAwqbg9q-TXSi6Sb8DPXAAcw29zd02GJarwO7QodcU"; // (Truncated for security)
  const searchInput = document.getElementById("movieSearchInput");
  const suggestionsBox = document.getElementById("movieSuggestions");
  let searchDebounce;

  function slugify(text) {
    return text.toString().toLowerCase()
               .replace(/\s+/g, '-')
               .replace(/[^\w\-]+/g, '')
               .replace(/\-\-+/g, '-')
               .replace(/^-+/, '')
               .replace(/-+$/, '');
  }

  function performMovieSearch(query) {
    if (!query) {
      suggestionsBox.style.display = "none";
      suggestionsBox.innerHTML = "";
      return;
    }
    fetch(`https://api.themoviedb.org/3/search/multi?query=${encodeURIComponent(query)}&language=en-US&page=1`, {
      headers: {
        Authorization: 'Bearer ' + tmdbToken,
        'Content-Type': 'application/json;charset=utf-8'
      }
    })
    .then(response => response.json())
    .then(data => {
      // Filter results to include only movies or TV shows with valid posters
      const results = data.results.filter(item => 
        (item.media_type === "movie" || item.media_type === "tv") && item.poster_path
      );
      renderMovieSuggestions(results);
    })
    .catch(err => console.error("Error fetching movie search:", err));
  }

  function renderMovieSuggestions(results) {
    suggestionsBox.innerHTML = "";
    if (results.length === 0) {
      suggestionsBox.style.display = "none";
      return;
    }
    results.forEach(item => {
      const suggestion = document.createElement("div");
      suggestion.className = "movie-suggestion-item";

      const img = document.createElement("img");
      img.src = "https://image.tmdb.org/t/p/w92" + item.poster_path;
      suggestion.appendChild(img);

      const titleDiv = document.createElement("div");
      titleDiv.className = "movie-title";
      titleDiv.textContent = item.title || item.name;
      suggestion.appendChild(titleDiv);

      suggestion.addEventListener("click", () => {
        const slug = slugify(item.title || item.name);
        let aurlParam = "";
        if (item.media_type === "movie") {
          aurlParam = encodeURIComponent(`tmdb-movie-${item.id}-${slug}`);
          window.location.href = `player.html?aurl=${aurlParam}`;
        } else if (item.media_type === "tv") {
          aurlParam = encodeURIComponent(`tmdb-tv-${item.id}-${slug}`);
          window.location.href = `player.html?aurl=${aurlParam}&series=1&episode=1`;
        }
      });
      suggestionsBox.appendChild(suggestion);
    });
    suggestionsBox.style.display = "block";
  }

  searchInput.addEventListener("input", () => {
    clearTimeout(searchDebounce);
    searchDebounce = setTimeout(() => {
      performMovieSearch(searchInput.value.trim());
    }, 300);
  });

  document.addEventListener("click", (e) => {
    if (!document.querySelector(".movie-search-wrapper").contains(e.target)) {
      suggestionsBox.style.display = "none";
    }
  });
</script>

</body>
</html>
